{% extends 'shop/base.html' %}
{% block title %} checkout {% endblock title %}

{% block body %}
<div class="container">
  <div class="col my-4">
    <h2>Step 1- My cart checkout - Review Your Cart Items</h2>
    <div class="mt-4">
      <ul class="list-group" id="items">
      </ul>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item active" aria-current="page">your total price is Rs. <b><span id="totalprice"></b></span> Thanks for using e- shopping cart</li>
        </ol>
      </nav>
     
    </div>
  </div>
  <div class="col my-4">
    <h2>Step 2- Enter Your details</h2>
    <form method="POST" action="/shop/checkout/">{% csrf_token %}
      <input type="hidden" id="itemsjson" name="itemsjson">
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="fname">First Name</label>
          <input type="text" class="form-control" id="fname" name="fname" placeholder="Enter Your first Name">
        </div>
        <div class="form-group col-md-6">
          <label for="Lname">Last Name</label>
          <input type="text" class="form-control" id="lname" name="lname" placeholder="Enter your last Name">
        </div>
        <div class="form-group col-md-6">
          <label for="phone">Mobile Number</label>
          <input type="tel" class="form-control" id="phone" name="phone" placeholder="Enter Your Mobile Number">
        </div>
        <div class="form-group col-md-6">
          <label for="email">Email</label>
          <input type="email" class="form-control" id="email" name="email" placeholder="Email">
        </div>

      </div>
      <div class="form-group">
        <label for="address">Address</label>
        <input type="text" class="form-control" id="address1" name="address1" placeholder="1234 Main St">
      </div>
      <div class="form-group">
        <label for="address2">Address 2</label>
        <input type="text" class="form-control" id="address2" name="address2" placeholder="Apartment, studio, or floor">
      </div>
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="city">City</label>
          <input type="text" class="form-control" name="city" id="city">
        </div>
        <div class="form-group col-md-4">
          <label for="state">State</label>
          <input type="text" class="form-control" id="state" name="state" placeholder="Enter Your State">
        </div>
        <div class="form-group col-md-2">
          <label for="zip_code">Zip</label>
          <input type="text" class="form-control" id="zip_code" name="zip_code">
        </div>
      </div>
  </div>
  <button type="submit" class="btn btn-primary">Place Order</button>
  </form>
</div>
</div>

{% endblock body %}
{% block js %}
  <script>
    if (localStorage.getItem('cart')==null){
      var cart = {};
    }
    else{
      cart = JSON.parse(localStorage.getItem('cart'));
      //document.getElementById('cart').innerHTML = Object.keys(cart).length;
  
    }
    console.log(cart);
    var sum = 0; 
    var totalprice = 0;
    if ($.isEmptyObject(cart)){
      //if object is empty
      mystr = `<p>Your cart is empty. please add  some  items your cart before checking out!</p>`
      $('#items').append(mystr);

    }
    else{
      for(item in cart){
        let name = cart[item][1];
        let qty = cart[item][0];
        let itemprice = cart[item][2];
        sum = sum + qty;
        totalprice = totalprice + qty * itemprice;
        mystr = `<li class="list-group-item d-flex justify-content-between align-items-center">
          ${name}
          <span class="badge badge-primary badge-pill">${qty}</span>
        </li>`
        $('#items').append(mystr);
      }
    }
    document.getElementById('cart').innerHTML = sum;
    document.getElementById('totalprice').innerHTML = totalprice;
    $('#itemsjson').val(JSON.stringify(cart));
    {% if thank %}
    alert('thanks for ordering with us. Your order is {{id}}. use it to track your oder using order tracker')
    localStorage.clear();
    document.location = "/shop";
    {% endif %}
  </script>
{% endblock js %}